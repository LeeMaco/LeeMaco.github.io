<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¡§å®¢æ»¿æ„åº¦èª¿æŸ¥</title>
    <style>
        /* --- CSS Reset & Variables --- */
        :root {
            --primary-color: #D4AF37; /* è³ªæ„Ÿé‡‘ (Brand Color) */
            --primary-hover: #b5952f;
            --text-dark: #333333;
            --text-light: #777777;
            --bg-color: #ffffff;
            --bg-secondary: #f8f9fa;
            --border-radius: 12px;
            --spacing-unit: 16px;
            --transition-speed: 0.3s;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; /* ç§»é™¤æ‰‹æ©Ÿé»æ“Šè—æ¡† */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            line-height: 1.5;
            padding-bottom: 80px; /* é ç•™åº•éƒ¨æŒ‰éˆ•ç©ºé–“ */
        }

        /* --- Components --- */
        
        /* 1. Header */
        header {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: var(--spacing-unit);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 60px;
        }

        .header-logo {
            height: 24px;
            margin-right: 10px;
            /* å‡è£æœ‰ Logo */
            width: 24px;
            background-color: var(--text-dark); 
            border-radius: 4px;
        }

        .header-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        /* 2. Container & Sections */
        .container {
            max-width: 600px; /* å¹³æ¿/æ¡Œæ©Ÿä¹Ÿä¸æœƒå¤ªå¯¬ */
            margin: 0 auto;
            padding: var(--spacing-unit);
        }

        .section {
            margin-bottom: calc(var(--spacing-unit) * 2);
            opacity: 1;
            transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
        }

        .section-hidden {
            display: none;
            opacity: 0;
            transform: translateY(20px);
        }

        .section-visible {
            display: block;
            animation: slideUp 0.5s forwards;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: var(--spacing-unit);
            text-align: center;
        }

        .subtitle {
            font-size: 0.95rem;
            color: var(--text-light);
            text-align: center;
            margin-bottom: var(--spacing-unit);
            display: block;
        }

        /* 3. Welcome Hero */
        .welcome-text {
            text-align: center;
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 30px;
        }

        /* 4. Stars Rating */
        .stars-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .star {
            font-size: 40px; /* å¤§æ‹‡æŒ‡å‹å–„ */
            color: #e0e0e0;
            cursor: pointer;
            transition: color 0.2s, transform 0.1s;
        }

        .star.active {
            color: #FFC107; /* æ˜Ÿæ˜Ÿé»ƒ */
        }

        .star:active {
            transform: scale(0.9);
        }

        /* 5. Tags (Pills) */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .tag {
            padding: 8px 16px;
            background-color: var(--bg-secondary);
            border: 1px solid #e0e0e0;
            border-radius: 50px;
            font-size: 0.9rem;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .tag.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        /* 6. Staff Scroll */
        .staff-scroll-view {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 10px 5px; /* ä¸Šä¸‹ç•™ç©ºçµ¦é™°å½± */
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox hide scrollbar */
        }
        .staff-scroll-view::-webkit-scrollbar {
            display: none; /* Chrome hide scrollbar */
        }

        .staff-card {
            flex: 0 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            cursor: pointer;
            scroll-snap-align: center;
            opacity: 0.6;
            transition: opacity 0.2s, transform 0.2s;
        }

        .staff-card.selected {
            opacity: 1;
            transform: scale(1.05);
        }

        .staff-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #eee;
            margin-bottom: 8px;
            overflow: hidden;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        
        .staff-card.selected .staff-avatar {
            border-color: var(--primary-color);
        }

        .staff-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .staff-name {
            font-size: 0.8rem;
            text-align: center;
            font-weight: 500;
        }

        /* 7. Textarea */
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
            resize: none;
            background-color: var(--bg-secondary);
        }
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: #fff;
        }

        /* 8. Submit Button */
        .submit-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: var(--spacing-unit);
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(5px);
            border-top: 1px solid #eee;
        }

        .btn-submit {
            width: 100%;
            padding: 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        .btn-submit:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .btn-submit:active:not(:disabled) {
            transform: scale(0.98);
        }

        /* Success State */
        .success-view {
            display: none;
            height: 100vh;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            animation: fadeIn 0.5s;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: white;
            z-index: 200;
        }

        .success-icon {
            font-size: 80px;
            color: #4CAF50;
            margin-bottom: 20px;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        /* Error Banner */
        .error-banner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>

    <div id="errorBanner" class="error-banner">
        <h2>âš ï¸ ç„¡æ³•è­˜åˆ¥åŒ…å»‚</h2>
        <p>è«‹é‡æ–°æƒææ¡Œä¸Šçš„ QR Code</p>
    </div>

    <div id="successView" class="success-view">
        <div class="success-icon">âœ…</div>
        <h2>æ„Ÿè¬æ‚¨çš„å›é¥‹ï¼</h2>
        <p class="subtitle">æ‚¨çš„è²éŸ³æ˜¯æˆ‘å€‘é€²æ­¥æœ€å¤§çš„å‹•åŠ›ã€‚<br>æœŸå¾…æ‚¨å†æ¬¡å…‰è‡¨ <span id="successRoomName"></span>ã€‚</p>
        <button class="tag" style="margin-top:20px; background:#fff; border:1px solid #ccc;" onclick="window.close()">é—œé–‰é é¢</button>
    </div>

    <div id="mainForm">
        <header>
            <div class="header-logo"></div> <div class="header-title" id="headerTitle">åŒ…å»‚è¼‰å…¥ä¸­...</div>
        </header>

        <div class="container">
            <div class="welcome-text">
                æ„Ÿè¬æ‚¨ä»Šæ—¥çš„å…‰è‡¨ã€‚ç‚ºäº†æä¾›æ›´å¥½çš„é«”é©—ï¼Œè€½èª¤æ‚¨ 30 ç§’æ™‚é–“ï¼Œå¸Œæœ›èƒ½è½è½æ‚¨çš„çœŸå¯¦æ„Ÿå—ã€‚
            </div>

            <div class="section">
                <h2>æ‚¨æ»¿æ„ä»Šå¤©çš„æ•´é«”é«”é©—å—ï¼Ÿ</h2>
                <div class="stars-container" id="starRating">
                    <span class="star" data-value="1">â˜…</span>
                    <span class="star" data-value="2">â˜…</span>
                    <span class="star" data-value="3">â˜…</span>
                    <span class="star" data-value="4">â˜…</span>
                    <span class="star" data-value="5">â˜…</span>
                </div>
            </div>

            <div id="expandedContent" class="section-hidden">
                
                <div class="section">
                    <span class="subtitle" id="tagSubtitle">è«‹é¸æ“‡æ¨™ç±¤</span>
                    <div class="tags-container" id="tagCloud">
                        </div>
                </div>

                <div class="section">
                    <span class="subtitle">æœ‰æ²’æœ‰å“ªä½å¤¥ä¼´è®“æ‚¨å°è±¡æ·±åˆ»ï¼Ÿ</span>
                    <div class="staff-scroll-view" id="staffScroll">
                        </div>
                </div>

                <div class="section">
                    <span class="subtitle">é‚„æœ‰å…¶ä»–æƒ³è·Ÿæˆ‘å€‘èªªçš„è©±å—ï¼Ÿ (é¸å¡«)</span>
                    <textarea id="commentBox" rows="3" placeholder="æ­¡è¿è¨±é¡˜..."></textarea>
                </div>

                <div style="height: 60px;"></div>
            </div>
        </div>

        <div class="submit-container">
            <button id="submitBtn" class="btn-submit" disabled>é€å‡ºè©•åƒ¹</button>
        </div>
    </div>

    <script>
        // --- 1. é…ç½®èˆ‡è³‡æ–™ (Configuration) ---
        const CONFIG = {
            tags_good: [
                "ğŸ‘ æœå‹™è¦ªåˆ‡", "ğŸš€ ä¸Šé¤è¿…é€Ÿ", "ğŸ§¹ ç’°å¢ƒæ•´æ½”", "ğŸµ æ°›åœå¾ˆå¥½", "ğŸ¤« éš±ç§æ€§ä½³"
            ],
            tags_bad: [
                "ğŸ¢ å‹•ä½œå¤ªæ…¢", "ğŸ˜ æ…‹åº¦å†·æ·¡", "ğŸ§¹ æ•´æ½”å¾…åŠ å¼·", "ğŸ—£ï¸ éš”éŸ³ä¸å¥½", "â„ï¸ ç©ºèª¿å•é¡Œ"
            ],
            // æ¨¡æ“¬å“¡å·¥è³‡æ–™ (æœªä¾†å¯æ¥ API)
            staff: [
                { id: 0, name: "æ²’ç‰¹åˆ¥æ³¨æ„", avatar: "https://ui-avatars.com/api/?name=-&background=eee&color=999" }, // é è¨­é¸é …
                { id: 1, name: "Andy", avatar: "https://ui-avatars.com/api/?name=Andy&background=random" },
                { id: 2, name: "Bella", avatar: "https://ui-avatars.com/api/?name=Bella&background=random" },
                { id: 3, name: "Chris", avatar: "https://ui-avatars.com/api/?name=Chris&background=random" },
                { id: 4, name: "Diana", avatar: "https://ui-avatars.com/api/?name=Diana&background=random" }
            ]
        };

        // --- 2. ç‹€æ…‹ç®¡ç† (State) ---
        let state = {
            roomId: null,
            rating: 0,
            selectedTags: [],
            selectedStaffId: 0 // é è¨­ 0
        };

        // --- 3. åˆå§‹åŒ– (Init) ---
        document.addEventListener('DOMContentLoaded', () => {
            // è§£æ URL åƒæ•¸
            const urlParams = new URLSearchParams(window.location.search);
            state.roomId = urlParams.get('room_id');

            // éŒ¯èª¤è™•ç†ï¼šå¦‚æœæ²’æœ‰ room_id
            if (!state.roomId) {
                // ç‚ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œå¦‚æœæ²’åƒæ•¸é è¨­çµ¦ä¸€å€‹ V01 (æ­£å¼ä¸Šç·šè«‹æŠŠä¸‹é¢é€™è¡Œè¨»è§£æ‰)
                 state.roomId = "V01 (Demo)";
                
                // æ­£å¼é‚è¼¯ï¼šå–æ¶ˆè¨»è§£ä¸‹æ–¹ä»£ç¢¼
                // document.getElementById('errorBanner').style.display = 'flex';
                // document.getElementById('mainForm').style.display = 'none';
                // return; 
            }

            // æ›´æ–° UI æ¨™é¡Œ
            document.getElementById('headerTitle').textContent = `${state.roomId} å°ˆå±¬æ„è¦‹å¡`;
            document.getElementById('successRoomName').textContent = state.roomId;

            initStaffList();
            setupEventListeners();
        });

        // --- 4. æ¸²æŸ“é‚è¼¯ (Rendering) ---

        // æ¸²æŸ“å“¡å·¥åˆ—è¡¨
        function initStaffList() {
            const container = document.getElementById('staffScroll');
            CONFIG.staff.forEach(person => {
                const el = document.createElement('div');
                el.className = `staff-card ${person.id === 0 ? 'selected' : ''}`;
                el.onclick = () => selectStaff(person.id, el);
                el.innerHTML = `
                    <div class="staff-avatar"><img src="${person.avatar}" alt="${person.name}"></div>
                    <div class="staff-name">${person.name}</div>
                `;
                container.appendChild(el);
            });
        }

        // æ¸²æŸ“æ¨™ç±¤é›² (æ ¹æ“šè©•åˆ†)
        function renderTags(isGood) {
            const container = document.getElementById('tagCloud');
            const subtitle = document.getElementById('tagSubtitle');
            const placeholder = document.getElementById('commentBox');
            
            container.innerHTML = ''; // æ¸…ç©º
            state.selectedTags = []; // é‡ç½®é¸æ“‡

            // æ›´æ–°æ–‡æ¡ˆ
            if (isGood) {
                subtitle.innerText = "å¤ªæ£’äº†ï¼è«‹å•æ‚¨è¦ºå¾—å“ªè£¡æœ€æ£’ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰";
                placeholder.placeholder = "æ­¡è¿è¨±é¡˜ï¼Œå‘Šè¨´æˆ‘å€‘å¦‚ä½•åšå¾—æ›´å¥½...";
                CONFIG.tags_good.forEach(tagText => createTagElement(tagText, container));
            } else {
                subtitle.innerText = "å¾ˆæŠ±æ­‰ã€‚è«‹å•æˆ‘å€‘å“ªè£¡éœ€è¦æ”¹é€²ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰";
                placeholder.placeholder = "è«‹å‘Šè¨´æˆ‘å€‘å…·é«”æƒ…æ³ï¼Œæˆ‘å€‘æœƒç«‹å³è™•ç†...";
                CONFIG.tags_bad.forEach(tagText => createTagElement(tagText, container));
            }
        }

        function createTagElement(text, container) {
            const btn = document.createElement('button');
            btn.className = 'tag';
            btn.textContent = text;
            btn.onclick = () => {
                btn.classList.toggle('selected');
                // æ›´æ–° State
                if (state.selectedTags.includes(text)) {
                    state.selectedTags = state.selectedTags.filter(t => t !== text);
                } else {
                    state.selectedTags.push(text);
                }
            };
            container.appendChild(btn);
        }

        // --- 5. äº’å‹•é‚è¼¯ (Interactions) ---

        function setupEventListeners() {
            // æ˜Ÿæ˜Ÿé»æ“Š
            const stars = document.querySelectorAll('.star');
            stars.forEach(star => {
                star.addEventListener('click', () => {
                    const value = parseInt(star.dataset.value);
                    state.rating = value;
                    updateStarsUI(value);
                    
                    // ç¬¬ä¸€æ¬¡é»æ“Šæ™‚ï¼Œå±•é–‹ä¸‹æ–¹å…§å®¹
                    const expandedSection = document.getElementById('expandedContent');
                    if(expandedSection.classList.contains('section-hidden')) {
                        expandedSection.classList.remove('section-hidden');
                        expandedSection.classList.add('section-visible');
                    }

                    // å•Ÿç”¨é€å‡ºæŒ‰éˆ•
                    document.getElementById('submitBtn').disabled = false;

                    // åˆ¤æ–·å¥½è©•/è² è©•ä¸¦é‡æ–°æ¸²æŸ“æ¨™ç±¤
                    renderTags(value >= 4);
                });
            });

            // é€å‡ºæŒ‰éˆ•
            document.getElementById('submitBtn').addEventListener('click', handleSubmit);
        }

        function updateStarsUI(value) {
            document.querySelectorAll('.star').forEach(s => {
                const sVal = parseInt(s.dataset.value);
                if (sVal <= value) {
                    s.classList.add('active');
                } else {
                    s.classList.remove('active');
                }
            });
        }

        function selectStaff(id, element) {
            state.selectedStaffId = id;
            // UI æ›´æ–°
            document.querySelectorAll('.staff-card').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
        }

        // --- 6. é€å‡ºè™•ç† (Submit) ---
        function handleSubmit() {
            const btn = document.getElementById('submitBtn');
            btn.innerText = "å‚³é€ä¸­...";
            btn.disabled = true;

            // æ”¶é›†æœ€çµ‚è³‡æ–™
            const finalData = {
                room_id: state.roomId,
                rating: state.rating,
                tags: state.selectedTags,
                staff_id: state.selectedStaffId,
                comment: document.getElementById('commentBox').value,
                timestamp: new Date().toISOString()
            };

            console.log("é€å‡ºè³‡æ–™:", finalData);

            // æ¨¡æ“¬ API å»¶é² (500ms)
            setTimeout(() => {
                // éš±è—è¡¨å–®ï¼Œé¡¯ç¤ºæˆåŠŸç•«é¢
                document.getElementById('mainForm').style.display = 'none';
                document.getElementById('successView').style.display = 'flex';
                
                // é€™è£¡å¯ä»¥åŠ å…¥ fetch() ç™¼é€è³‡æ–™åˆ°å¾Œç«¯
            }, 500);
        }

    </script>
</body>
</html>
